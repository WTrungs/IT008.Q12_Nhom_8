<Page x:Class="TetrisApp.Views.GamePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      mc:Ignorable="d"
      d:DesignWidth="1000" d:DesignHeight="650"
      Title="GamePage"
      Background="{StaticResource SpaceBackground}"
	  Focusable="True"
      PreviewKeyDown="Page_KeyDown" 
      PreviewKeyUp="Page_KeyUp"
	  KeyboardNavigation.DirectionalNavigation="None">

    <Page.Resources>
        <!-- Grid Tile Brush -->
        <DrawingBrush x:Key="GridTileBrush"
                      TileMode="Tile"
                      Viewport="0,0,26,26" ViewportUnits="Absolute"
                      Viewbox="0,0,26,26" ViewboxUnits="Absolute">
            <DrawingBrush.Drawing>
                <GeometryDrawing Brush="#0D1020">
                    <GeometryDrawing.Pen>
                        <Pen Brush="#2A2A33" Thickness="1"/>
                    </GeometryDrawing.Pen>
                    <GeometryDrawing.Geometry>
                        <RectangleGeometry Rect="0,0,26,26"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingBrush.Drawing>
        </DrawingBrush>
    </Page.Resources>

    <Grid>
        <!-- NỀN -->
        <Rectangle Fill="{StaticResource SpaceBackground}"/>

        <!-- NEBULA / GLOW -->
        <Canvas IsHitTestVisible="True" Opacity="0.9">
            <Ellipse Width="700" Height="700" Canvas.Left="-219" Canvas.Top="-340" Fill="#557C3AED">
                <Ellipse.Effect>
                    <BlurEffect Radius="60"/>
                </Ellipse.Effect>
            </Ellipse>

            <Ellipse Width="700" Height="700" Canvas.Left="190" Canvas.Top="325" Fill="#BA748D" HorizontalAlignment="Left" VerticalAlignment="Center">
                <Ellipse.Effect>
                    <BlurEffect Radius="60"/>
                </Ellipse.Effect>
            </Ellipse>

            <Ellipse Width="700" Height="694" Canvas.Left="650" Canvas.Top="-267" Fill="#4E7198">
                <Ellipse.Effect>
                    <BlurEffect Radius="60"/>
                </Ellipse.Effect>
            </Ellipse>

            <Ellipse Width="700" Height="700" Canvas.Right="-160" Canvas.Top="325" Fill="#5522D3EE" Canvas.Left="890" HorizontalAlignment="Left" VerticalAlignment="Top">
                <Ellipse.Effect>
                    <BlurEffect Radius="70"/>
                </Ellipse.Effect>
            </Ellipse>

            <Ellipse Width="700" Height="700" Canvas.Left="-536" Canvas.Bottom="-220" Fill="#44FB7185" HorizontalAlignment="Left" Canvas.Top="356" VerticalAlignment="Top">
                <Ellipse.Effect>
                    <BlurEffect Radius="80"/>
                </Ellipse.Effect>
            </Ellipse>
        </Canvas>

        <!-- STARS -->
        <Rectangle Fill="{StaticResource StarsBrush}" Opacity="0.30" IsHitTestVisible="False"/>

        <Grid Margin="22">
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
                <ColumnDefinition Width="449.6"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT: Gameplay -->
            <Border Style="{StaticResource GlassCard}" Margin="0,0,4,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Top Bar -->
                    <DockPanel Margin="0,0,0,12">
                        <TextBlock Text="GAME PLAY"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   DockPanel.Dock="Left"/>
                    </DockPanel>

                    <!-- Board -->
                    <Border Grid.Row="1"
                            CornerRadius="14"
                            BorderBrush="#2A2A33"
                            BorderThickness="1"
                            Background="#0D1020"
                            Padding="12"
							>

                        <!-- Viewbox để board có thể phóng to/thu nhỏ theo màn hình nhưng giữ tỉ lệ -->
                        <Viewbox Stretch="Uniform"
                                 HorizontalAlignment="Center"
                                 VerticalAlignment="Center">

                            <!-- Vùng board: 10*26 = 260, 20*26 = 520 -->
							<Border x:Name="BoardBorder"
									Width="260" Height="520"
                                    CornerRadius="12"
                                    BorderBrush="#FF5E5E7E"
                                    BorderThickness="2"
                                    Background="{StaticResource GridTileBrush}">
                                
                                <!--<Canvas/>-->
								<Grid x:Name="BoardClipHost">
									<UniformGrid x:Name="GameGrid" Rows="20" Columns="10" Background="Transparent"/>
								</Grid>
							</Border>
                        </Viewbox>
                    </Border>
                </Grid>
            </Border>

            <!-- RIGHT: Info Panel -->
            <Border Grid.Column="1"
                    Margin="16,0,0,1"
                    Style="{StaticResource GlassCard}">
                <StackPanel>

                    <!-- Score / Level -->
                    <Grid Margin="0,0,0,14">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border Padding="12" CornerRadius="12" Background="#6610152A" BorderBrush="#2A2A33" BorderThickness="1" Margin="0,0,10,0">
                            <StackPanel>
                                <TextBlock Text="SCORE" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" FontWeight="Bold"/>
                                <TextBlock x:Name="ScoreText" Text="0" FontSize="26" FontWeight="Bold" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" Padding="12" CornerRadius="12" Background="#6610152A" BorderBrush="#2A2A33" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="LEVEL" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" FontWeight="Bold"/>
                                <TextBlock x:Name="LevelText" Text="1" FontSize="26" FontWeight="Bold" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Lines -->
                    <Border Padding="12" CornerRadius="12" Background="#6610152A" BorderBrush="#2A2A33" BorderThickness="1" Margin="0,0,0,14">
                        <StackPanel>
                            <TextBlock Text="LINES" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" FontWeight="Bold"/>
                            <TextBlock x:Name="LinesText" Text="0" FontSize="26" FontWeight="Bold" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Hold / Next -->
                    <Grid Margin="0,0,0,14">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="98*"/>
                            <ColumnDefinition Width="98*"/>
                        </Grid.ColumnDefinitions>

                        <Border Padding="12" 
                                CornerRadius="12" 
                                Background="#6610152A" 
                                BorderBrush="#2A2A33" 
                                BorderThickness="1" 
                                Margin="2,1,1,-1" 
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform/>
                                    <SkewTransform AngleY="-0.512"/>
                                    <RotateTransform/>
                                    <TranslateTransform Y="-0.591"/>
                                </TransformGroup>
                            </Border.RenderTransform>
                            <StackPanel>
                                <TextBlock Text="HOLD" 
                                           Foreground="{StaticResource TextMuted}" 
                                           HorizontalAlignment="Center" 
                                           FontWeight="Bold"/>
                                <Border Height="131.25"
                                        Width="131.25"
                                        Margin="0,8,0,0"
                                        CornerRadius="12"
                                        BorderBrush="#2A2A33"
                                        BorderThickness="1"
                                        Background="#0D1020"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="1"
                                Padding="12"
                                CornerRadius="12"
                                Background="#6610152A"
                                BorderBrush="#2A2A33"
                                BorderThickness="1"
                                Margin="1,1,2,-1"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform/>
                                    <SkewTransform AngleY="-0.512"/>
                                    <RotateTransform/>
                                    <TranslateTransform Y="-0.591"/>
                                </TransformGroup>
                            </Border.RenderTransform>

                            <StackPanel>
                                <TextBlock Text="NEXT"
                                           Foreground="{StaticResource TextMuted}"
                                           HorizontalAlignment="Center"
                                           FontWeight="Bold"/>
                                <Border Height="131.25"
                                        Width="131.25"
                                        Margin="0,8,0,0"
                                        CornerRadius="12"
                                        BorderBrush="#2A2A33"
                                        BorderThickness="1"
                                        Background="#0D1020"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Controls -->
                    <Border Padding="12" CornerRadius="12" Background="#6610152A" BorderBrush="#2A2A33" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="CONTROLS" Foreground="{StaticResource TextMuted}" FontWeight="Bold" HorizontalAlignment="Center"/>
                            <TextBlock Margin="0,8,0,0"
                                       Text="← → : Change&#10;↑ : Rotate&#10;↓ : Soft Drop&#10;Space : Hard Drop&#10;C/Shift : Hold&#10;P : Pause"/>
                        </StackPanel>
                    </Border>

                    <!-- Back -->
                    <Button Style="{StaticResource SpaceButton}"
                            Content="Back to Menu"
                            Margin="0,14,0,0"
                            Click="BackButton_Click"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>