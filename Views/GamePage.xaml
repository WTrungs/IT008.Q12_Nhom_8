<Page x:Class="TetrisApp.Views.GamePage"
	  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	  mc:Ignorable="d"
	  d:DesignWidth="1000" d:DesignHeight="650"
	  Title="GamePage"
	  Background="{StaticResource SpaceBackground}"
	  Focusable="True"
	  PreviewKeyDown="Page_KeyDown" 
	  PreviewKeyUp="Page_KeyUp"
	  KeyboardNavigation.DirectionalNavigation="None">

	<Page.Resources>
		<!-- Grid Tile Brush -->
		<DrawingBrush x:Key="GridTileBrush"
					  TileMode="Tile"
					  Viewport="0,0,26,26" ViewportUnits="Absolute"
					  Viewbox="0,0,26,26" ViewboxUnits="Absolute">
			<DrawingBrush.Drawing>
				<GeometryDrawing Brush="#0D1020">
					<GeometryDrawing.Pen>
						<Pen Brush="#2A2A33" Thickness="1"/>
					</GeometryDrawing.Pen>
					<GeometryDrawing.Geometry>
						<RectangleGeometry Rect="0,0,26,26"/>
					</GeometryDrawing.Geometry>
				</GeometryDrawing>
			</DrawingBrush.Drawing>
		</DrawingBrush>

		<SolidColorBrush x:Key="ColorI" Color="#00FFFF"/>
		<SolidColorBrush x:Key="ColorL" Color="#FFF6993E"/>
		<SolidColorBrush x:Key="ColorJ" Color="#FF4D7FEB"/>
		<SolidColorBrush x:Key="ColorO" Color="#FFFCFC3F"/>
		<SolidColorBrush x:Key="ColorS" Color="#FF28E987"/>
		<SolidColorBrush x:Key="ColorT" Color="#FFE664E6"/>
		<SolidColorBrush x:Key="ColorZ" Color="#FFF45858"/>

		<Style x:Key="BlockStyle" TargetType="Border">
			<Setter Property="BorderBrush" Value="#44ffffff"/>
			<Setter Property="BorderThickness" Value="0.5"/>
			<Setter Property="CornerRadius" Value="3"/>
		</Style>

		<ControlTemplate x:Key="TetrominoI">
			<Grid Width="104" Height="26">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>
				<Border Grid.Column="0" Background="{StaticResource ColorI}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Column="1" Background="{StaticResource ColorI}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Column="2" Background="{StaticResource ColorI}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Column="3" Background="{StaticResource ColorI}" Style="{StaticResource BlockStyle}"/>
			</Grid>
		</ControlTemplate>

		<ControlTemplate x:Key="TetrominoJ">
			<Grid Width="78" Height="52">
				<Grid.RowDefinitions>
					<RowDefinition/>
					<RowDefinition/>
				</Grid.RowDefinitions>
				<Grid.ColumnDefinitions>
					<ColumnDefinition/>
					<ColumnDefinition/>
					<ColumnDefinition/>
				</Grid.ColumnDefinitions>
				<Border Grid.Row="0" Grid.Column="0" Background="{StaticResource ColorJ}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="0" Background="{StaticResource ColorJ}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="1" Background="{StaticResource ColorJ}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="2" Background="{StaticResource ColorJ}" Style="{StaticResource BlockStyle}"/>
			</Grid>
		</ControlTemplate>

		<ControlTemplate x:Key="TetrominoL">
			<Grid Width="78" Height="52">
				<Grid.RowDefinitions>
					<RowDefinition/>
					<RowDefinition/>
				</Grid.RowDefinitions>
				<Grid.ColumnDefinitions>
					<ColumnDefinition/>
					<ColumnDefinition/>
					<ColumnDefinition/>
				</Grid.ColumnDefinitions>
				<Border Grid.Row="0" Grid.Column="2" Background="{StaticResource ColorL}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="0" Background="{StaticResource ColorL}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="1" Background="{StaticResource ColorL}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="2" Background="{StaticResource ColorL}" Style="{StaticResource BlockStyle}"/>
			</Grid>
		</ControlTemplate>

		<ControlTemplate x:Key="TetrominoO">
			<Grid Width="52" Height="52">
				<Grid.RowDefinitions>
					<RowDefinition/>
					<RowDefinition/>
				</Grid.RowDefinitions>
				<Grid.ColumnDefinitions>
					<ColumnDefinition/>
					<ColumnDefinition/>
				</Grid.ColumnDefinitions>
				<Border Grid.Row="0" Grid.Column="0" Background="{StaticResource ColorO}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="0" Grid.Column="1" Background="{StaticResource ColorO}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="0" Background="{StaticResource ColorO}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="1" Background="{StaticResource ColorO}" Style="{StaticResource BlockStyle}"/>
			</Grid>
		</ControlTemplate>

		<ControlTemplate x:Key="TetrominoS">
			<Grid Width="78" Height="52">
				<Grid.RowDefinitions>
					<RowDefinition/>
					<RowDefinition/>
				</Grid.RowDefinitions>
				<Grid.ColumnDefinitions>
					<ColumnDefinition/>
					<ColumnDefinition/>
					<ColumnDefinition/>
				</Grid.ColumnDefinitions>
				<Border Grid.Row="0" Grid.Column="1" Background="{StaticResource ColorS}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="0" Grid.Column="2" Background="{StaticResource ColorS}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="0" Background="{StaticResource ColorS}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="1" Background="{StaticResource ColorS}" Style="{StaticResource BlockStyle}"/>
			</Grid>
		</ControlTemplate>

		<ControlTemplate x:Key="TetrominoT">
			<Grid Width="78" Height="52">
				<Grid.RowDefinitions>
					<RowDefinition/>
					<RowDefinition/>
				</Grid.RowDefinitions>
				<Grid.ColumnDefinitions>
					<ColumnDefinition/>
					<ColumnDefinition/>
					<ColumnDefinition/>
				</Grid.ColumnDefinitions>
				<Border Grid.Row="0" Grid.Column="1" Background="{StaticResource ColorT}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="0" Background="{StaticResource ColorT}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="1" Background="{StaticResource ColorT}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="2" Background="{StaticResource ColorT}" Style="{StaticResource BlockStyle}"/>
			</Grid>
		</ControlTemplate>

		<ControlTemplate x:Key="TetrominoZ">
			<Grid Width="78" Height="52">
				<Grid.RowDefinitions>
					<RowDefinition/>
					<RowDefinition/>
				</Grid.RowDefinitions>
				<Grid.ColumnDefinitions>
					<ColumnDefinition/>
					<ColumnDefinition/>
					<ColumnDefinition/>
				</Grid.ColumnDefinitions>
				<Border Grid.Row="0" Grid.Column="0" Background="{StaticResource ColorZ}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="0" Grid.Column="1" Background="{StaticResource ColorZ}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="1" Background="{StaticResource ColorZ}" Style="{StaticResource BlockStyle}"/>
				<Border Grid.Row="1" Grid.Column="2" Background="{StaticResource ColorZ}" Style="{StaticResource BlockStyle}"/>
			</Grid>
		</ControlTemplate>
	</Page.Resources>

	<Grid>
		<!-- NỀN -->
        <Image Source="/Assets/Images/Background.png"
               Stretch="UniformToFill"
               RenderOptions.BitmapScalingMode="HighQuality"
               IsHitTestVisible="False"/>

        <!-- STARS -->
		<Rectangle Fill="{StaticResource StarsBrush}" Opacity="0.30" IsHitTestVisible="False"/>

		<Grid Margin="22">
			<Grid.ColumnDefinitions>
				<ColumnDefinition/>
				<ColumnDefinition Width="449.6"/>
			</Grid.ColumnDefinitions>

			<!-- LEFT: Gameplay -->
			<Border Style="{StaticResource GlassCard}" Margin="0,0,4,0">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>

					<!-- Top Bar -->
					<DockPanel Margin="0,0,0,12">
						<TextBlock Text="GAME PLAY"
								   FontSize="20"
								   FontWeight="Bold"
								   DockPanel.Dock="Left"/>
					</DockPanel>

					<!-- Board -->
                    <Border Grid.Row="1"
							Padding="12"
							Background="Transparent"
							BorderThickness="0">

                        <!-- Viewbox to scale the board while maintaining aspect ratio -->
						<Viewbox Stretch="Uniform"
								 HorizontalAlignment="Center"
								 VerticalAlignment="Center">

							<!-- Board area: 10*26 = 260, 20*26 = 520 -->
							<Grid Width="260" Height="520">
								<Grid.RenderTransform>
									<TranslateTransform x:Name="ShakeBoardTransform" X="0" Y="0" />
								</Grid.RenderTransform>
								<Border x:Name="GridBackground"
									CornerRadius="10"
									Background="{StaticResource GridTileBrush}"/>
								<Border CornerRadius="10">
									<Border.Clip>
										<RectangleGeometry Rect="0,0,260,520" RadiusX="12" RadiusY="12"/>
									</Border.Clip>

									<Grid x:Name="BoardClipHost">
										<UniformGrid x:Name="GameGrid" Rows="20" Columns="10" Background="Transparent"/>
									</Grid>
								</Border>
								<Border x:Name="BoardBorder"
										CornerRadius="10"
										BorderBrush="#FF5E5E7E"
										BorderThickness="2"
										IsHitTestVisible="False"/>
							</Grid>
						</Viewbox>
					</Border>
				</Grid>
			</Border>

			<!-- RIGHT: Info Panel -->
			<Border Grid.Column="1"
					Margin="16,0,0,1"
					Style="{StaticResource GlassCard}">
				<StackPanel>

					<!-- Score / Level -->
					<Grid Margin="0,0,0,14">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<Border Padding="12" CornerRadius="12" Background="#6610152A" BorderBrush="#2A2A33" BorderThickness="1" Margin="0,0,10,0">
							<StackPanel>
								<TextBlock Text="SCORE" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" FontWeight="Bold"/>
								<TextBlock x:Name="ScoreText" Text="0" FontSize="26" FontWeight="Bold" HorizontalAlignment="Center"/>
							</StackPanel>
						</Border>

						<Border Grid.Column="1" Padding="12" CornerRadius="12" Background="#6610152A" BorderBrush="#2A2A33" BorderThickness="1">
							<StackPanel>
								<TextBlock Text="LEVEL" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" FontWeight="Bold"/>
								<TextBlock x:Name="LevelText" Text="1" FontSize="26" FontWeight="Bold" HorizontalAlignment="Center"/>
							</StackPanel>
						</Border>
					</Grid>

					<!-- Lines -->
					<Border Padding="12" CornerRadius="12" Background="#6610152A" BorderBrush="#2A2A33" BorderThickness="1" Margin="0,0,0,14">
						<StackPanel>
							<TextBlock Text="LINES" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" FontWeight="Bold"/>
							<TextBlock x:Name="LinesText" Text="0" FontSize="26" FontWeight="Bold" HorizontalAlignment="Center"/>
						</StackPanel>
					</Border>

					<!-- Hold / Next -->
					<Grid Margin="0,0,0,14">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="98*"/>
							<ColumnDefinition Width="98*"/>
						</Grid.ColumnDefinitions>

						<Border Padding="12" 
								CornerRadius="12" 
								Background="#6610152A" 
								BorderBrush="#2A2A33" 
								BorderThickness="1" 
								Margin="2,1,1,-1" 
								RenderTransformOrigin="0.5,0.5">
							<Border.RenderTransform>
								<TransformGroup>
									<ScaleTransform/>
									<SkewTransform AngleY="-0.512"/>
									<RotateTransform/>
									<TranslateTransform Y="-0.591"/>
								</TransformGroup>
							</Border.RenderTransform>
							<StackPanel>
								<TextBlock Text="HOLD" 
										   Foreground="{StaticResource TextMuted}" 
										   HorizontalAlignment="Center" 
										   FontWeight="Bold"/>
								<Border x:Name="HoldBorder"  Height="130" Width="130"
										CornerRadius="12"
										BorderBrush="#2A2A33"
										BorderThickness="0"
										Margin="0,8,0,0"
										Background="#0D1020">
								</Border>
							</StackPanel>
						</Border>
						<Border Grid.Column="1"
								Padding="12"
								CornerRadius="12"
								Background="#6610152A"
								BorderBrush="#2A2A33"
								BorderThickness="1"
								Margin="1,1,2,-1"
								RenderTransformOrigin="0.5,0.5">
							<Border.RenderTransform>
								<TransformGroup>
									<ScaleTransform/>
									<SkewTransform AngleY="-0.512"/>
									<RotateTransform/>
									<TranslateTransform Y="-0.591"/>
								</TransformGroup>
							</Border.RenderTransform>

							<StackPanel>
								<TextBlock Text="NEXT"
										   Foreground="{StaticResource TextMuted}"
										   HorizontalAlignment="Center"
										   FontWeight="Bold"/>
								<Border x:Name="NextBorder"
										Height="130" Width="130"
										CornerRadius="12"
										BorderBrush="#2A2A33"
										BorderThickness="0"
										Margin="0,8,0,0"
										Background="#0D1020">
								</Border>
							</StackPanel>
						</Border>
					</Grid>

					<!-- Controls -->
					<Border Padding="12" CornerRadius="12" Background="#6610152A" BorderBrush="#2A2A33" BorderThickness="1">
						<StackPanel>
							<TextBlock Text="CONTROLS" Foreground="{StaticResource TextMuted}" FontWeight="Bold" HorizontalAlignment="Center"/>
							<Grid>
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="*"/>
								</Grid.ColumnDefinitions>
								<TextBlock Grid.Row="0" Grid.Column="0" Margin="0,8,0,0"
									Text="← → : Move&#10;↓ : Soft Drop&#10;Space : Hard Drop&#10;C LeftShift RightShift : Hold&#10;Esc : Pause"/>
								<TextBlock Grid.Row="0" Grid.Column="1" Margin="0,8,0,0"
									Text="Z : Rotate Counter-clockwise&#10;↑ X : Rotate Clockwise&#10;A : Rotate 180°&#10;"/>
							</Grid>
						</StackPanel>
					</Border>
				</StackPanel>
			</Border>
		</Grid>
		
		<!-- Pause game -->
        <Grid>
            <Grid x:Name="PauseOverlay" Visibility="Collapsed" Background="#B3000000">
                <Border Background="{StaticResource SpaceBackground}" 
                BorderBrush="#2A2A33" BorderThickness="1" 
                CornerRadius="16" 
                Padding="40"
                HorizontalAlignment="Center" 
                VerticalAlignment="Center">

                    <StackPanel MinWidth="200"
                        KeyboardNavigation.DirectionalNavigation="Cycle"
                        KeyboardNavigation.TabNavigation="Cycle">

                        <Border x:Name="FocusPark"
								Focusable="True"
								KeyboardNavigation.IsTabStop="False"
								Width="0" Height="0"/>

                        <TextBlock Text="PAUSED" 
								Foreground="White" 
								FontSize="32" 
								FontWeight="Bold" 
								HorizontalAlignment="Center" 
								Margin="0,0,0,30"/>

                        <Button x:Name="ResumeBtn"
								Content="RESUME" 
								Height="40"
								Margin="0,0,0,10"
								Click="ResumeButton_Click"
								GotKeyboardFocus="Control_GotKeyboardFocus"
								Style="{StaticResource SpaceButton}"
								IsTabStop="True"
                                TabIndex="0"/>

                        <Button Content="RESTART" 
								Height="40" 
								Margin="0,0,0,10"
								Click="RestartButton_Click" 
								GotKeyboardFocus="Control_GotKeyboardFocus"
								Style="{StaticResource SpaceButton}"
								IsTabStop="True"
                                TabIndex="1"/>

                        <Button Content="BACK TO MENU" 
								Height="40"
								Click="QuitButton_Click"
								GotKeyboardFocus="Control_GotKeyboardFocus"
								Style="{StaticResource SpaceButton}"
                                IsTabStop="True"
                                TabIndex="2"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Page>