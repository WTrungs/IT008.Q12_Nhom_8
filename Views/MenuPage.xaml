<Page x:Class="TetrisApp.Views.MenuPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      mc:Ignorable="d"
      d:DesignHeight="650" d:DesignWidth="1000"
      Title="Menu"
      Background="{StaticResource SpaceBackground}"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True">

    <Page.Resources>
        <Style x:Key="SideMenuStyle" TargetType="Border" BasedOn="{StaticResource GlassCard}">
            <Setter Property="Width" Value="280"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
            <Setter Property="Margin" Value="0,62,0,0"/>
            <Setter Property="Panel.ZIndex" Value="50"/>
            <Setter Property="KeyboardNavigation.TabNavigation" Value="None"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TranslateTransform X="-300"/>
                </Setter.Value>
            </Setter>

            <Style.Triggers>
                <DataTrigger Binding="{Binding IsChecked, ElementName=HamburgerToggle}" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <TranslateTransform X="0"/>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="KeyboardNavigation.TabNavigation" Value="Continue"/>
                </DataTrigger>

                <DataTrigger Binding="{Binding IsMouseOver, ElementName=HamburgerToggle}" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <TranslateTransform X="0"/>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>

                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <TranslateTransform X="0"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="HamburgerButton" TargetType="ToggleButton">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="46"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Background" Value="#1A1D2B"/>
            <Setter Property="BorderBrush" Value="#2A2A33"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="Bd"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="14">
                            <Grid Margin="14,14">
                                <StackPanel VerticalAlignment="Center">
                                    <Rectangle Height="2" RadiusX="1" RadiusY="1" Fill="#EAF0FF"/>
                                    <Rectangle Height="2" RadiusX="1" RadiusY="1" Fill="#EAF0FF" Margin="0,6,0,0"/>
                                    <Rectangle Height="2" RadiusX="1" RadiusY="1" Fill="#EAF0FF" Margin="0,6,0,0"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#22D3EE"/>
                                <Setter TargetName="Bd" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#22D3EE" BlurRadius="22" ShadowDepth="0" Opacity="0.55"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>

                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#22D3EE"/>
                                <Setter TargetName="Bd" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#22D3EE" BlurRadius="22" ShadowDepth="0" Opacity="0.55"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>

                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#22D3EE"/>
                            </Trigger>

                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.85"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <SolidColorBrush x:Key="ScrollTrackBrush" Color="#331A1D2B"/>
        <SolidColorBrush x:Key="ScrollThumbBrush" Color="#22D3EE"/>

        <Style x:Key="SpaceScrollBar" TargetType="ScrollBar">
            <Setter Property="Width" Value="8"/>
            <Setter Property="Background" Value="#3A3F4A"/>
            <Setter Property="Foreground" Value="#8A8F9B"/>
            <Setter Property="UseLayoutRounding" Value="True"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                Padding="1"
                                SnapsToDevicePixels="True"
                                ClipToBounds="True">

                            <Track x:Name="PART_Track"
                                   IsDirectionReversed="True"
                                   Orientation="{TemplateBinding Orientation}"
                                   Minimum="{TemplateBinding Minimum}"
                                   Maximum="{TemplateBinding Maximum}"
                                   Value="{TemplateBinding Value}"
                                   ViewportSize="{TemplateBinding ViewportSize}"
                                   Margin="0,1">

                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.PageUpCommand" Opacity="0" Focusable="False"/>
                                </Track.DecreaseRepeatButton>

                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.PageDownCommand" Opacity="0" Focusable="False"/>
                                </Track.IncreaseRepeatButton>

                                <Track.Thumb>
                                    <Thumb Focusable="False">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border x:Name="ThumbBd"
                                                        Background="{TemplateBinding Foreground}"
                                                        CornerRadius="8"
                                                        MinHeight="22"/>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="ThumbBd" Property="Background" Value="#A7ACB7"/>
                                                    </Trigger>
                                                    <Trigger Property="IsDragging" Value="True">
                                                        <Setter TargetName="ThumbBd" Property="Background" Value="#C2C6CF"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SpaceScrollViewer" TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                            </Grid.ColumnDefinitions>

                            <ScrollContentPresenter Grid.Column="0" Margin="0,0,8,0"/>

                            <ScrollBar Grid.Column="1"
                                       Orientation="Vertical"
                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Value="{TemplateBinding VerticalOffset}"
                                       Style="{StaticResource SpaceScrollBar}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid x:Name="RootGrid"
          Focusable="True"
          KeyboardNavigation.IsTabStop="False"
          KeyboardNavigation.TabNavigation="Cycle"
          Loaded="MenuPage_Loaded">
        <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition Height="0*"/>
        </Grid.RowDefinitions>
        <Image Source="/Assets/Images/Background.png"
               Stretch="UniformToFill"
               RenderOptions.BitmapScalingMode="HighQuality"
               IsHitTestVisible="False"/>

        <Rectangle Fill="{StaticResource StarsBrush}" Opacity="0.35" IsHitTestVisible="False" Grid.RowSpan="2"/>

        <Grid Margin="22,22,22,21">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <DockPanel Grid.Row="0" Margin="0,0,0,14">
                <ToggleButton x:Name="HamburgerToggle"
                              Style="{StaticResource HamburgerButton}"
                              DockPanel.Dock="Left"
                              TabIndex="4"
                              PreviewKeyDown="HamburgerToggle_PreviewKeyDown"
                              GotKeyboardFocus="Control_GotKeyboardFocus"/>

                <TextBlock 
                           FontSize="22"
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           Margin="12,0,0,0"
                           DockPanel.Dock="Left"/>
            </DockPanel>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>

                <!-- TITLE -->
                <Border VerticalAlignment="Top"
                        HorizontalAlignment="Center"
                        Width="824"
                        Height="150"
                        Margin="0,78,0,0"
                        CornerRadius="75"
                        BorderBrush="#EAF0FF"
                        BorderThickness="5"
                        Background="#6622D3EE"
                        SnapsToDevicePixels="True">

                    <Border.Effect>
                        <DropShadowEffect ShadowDepth="0" Opacity="0.25"/>
                    </Border.Effect>

                    <TextBlock Text="TETRIS GAME"
                               FontSize="88"
                               FontWeight="ExtraBold"
                               FontStretch="Expanded"
                               Foreground="White"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               TextAlignment="Center">
                        <TextBlock.Effect>
                            <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.35"/>
                        </TextBlock.Effect>
                    </TextBlock>
                </Border>

                <Border Style="{StaticResource GlassCard}" VerticalAlignment="Top" Margin="313,273,313,0" Height="380" Width="330">
                    <StackPanel>
                        <TextBlock Text="MENU"
                                   FontSize="44"
                                   FontWeight="Bold"
                                   FontStretch="Expanded"
                                   HorizontalAlignment="Center"/>

                        <TextBlock Text="Choose your mission"
                                   Foreground="{StaticResource TextMuted}"
                                   HorizontalAlignment="Center"
                                   Margin="0,6,0,22"/>

                        <Button  x:Name="NewGameButton"
                                Style="{StaticResource SpaceButton}" Content="New Game"
                                Click="NewGameButton_Click" 
                                GotKeyboardFocus="Control_GotKeyboardFocus"
                                TabIndex="0" Height="50" Margin="0,0,0,10" Effect="{Binding BasedOn.TargetType.BaseType.DeclaringType.DeclaringMethod, Mode=OneWay, Source={StaticResource SpaceButton}}"/>

                        <Button Style="{StaticResource SpaceButton}" Content="Continue"
                                Click="ContinueButton_Click" 
                                GotKeyboardFocus="Control_GotKeyboardFocus"
                                TabIndex="1" Height="50" Margin="0,0,0,10"/>

                        <Button Style="{StaticResource SpaceButton}" Content="Save Game"
                                Click="SaveGameButton_Click"
                                GotKeyboardFocus="Control_GotKeyboardFocus"
                                TabIndex="2" Height="50" Margin="0,0,0,10"/>

                        <Button Style="{StaticResource SpaceButton}" Content="Exit"
                                Click="ExitButton_Click" 
                                GotKeyboardFocus="Control_GotKeyboardFocus"
                                BorderBrush="#FB7185"
                                TabIndex="3" Height="50"/>
                    </StackPanel>
                </Border>

                <Border x:Name="SideMenu"
                        Style="{StaticResource SideMenuStyle}" 
                        Margin="-4,-14,0,0">

                    <StackPanel>
                        <TextBlock Text="Account" FontSize="18" FontWeight="Bold" Margin="0,0,0,20" HorizontalAlignment="Center"/>

                        <Border CornerRadius="14"
                                BorderBrush="#2A2A33" BorderThickness="1"
                                Background="#14182A"
                                Padding="12"
                                Margin="0,0,0,11">

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0"
                                        Width="44" Height="44"
                                        Padding="0"
                                        BorderThickness="1"
                                        BorderBrush="#2A2A33"
                                        Background="#20243A"
                                        Cursor="Hand"
                                        TabIndex="5">

                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="AvatarBd"
                                                    Width="44" Height="44"
                                                    CornerRadius="22"
                                                    Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}">
                                                <TextBlock Text="👤"
                                                   FontSize="18"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Foreground="{StaticResource TextMuted}"/>
                                            </Border>

                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsKeyboardFocused" Value="True">
                                                    <Setter TargetName="AvatarBd" Property="BorderBrush" Value="#22D3EE"/>
                                                    <Setter TargetName="AvatarBd" Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect Color="#22D3EE" BlurRadius="18" ShadowDepth="0" Opacity="0.55"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Trigger>

                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="AvatarBd" Property="BorderBrush" Value="#22D3EE"/>
                                                    <Setter TargetName="AvatarBd" Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect Color="#22D3EE" BlurRadius="18" ShadowDepth="0" Opacity="0.55"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="AvatarBd" Property="Opacity" Value="0.85"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>

                                <StackPanel Grid.Column="1" Margin="12,0,12,0" VerticalAlignment="Center">
                                    <TextBlock x:Name="UserNameText"
                                               Text="Guest"
                                               FontWeight="Bold"
                                               FontSize="15"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <Button Style="{StaticResource SpaceButton}" Content="Settings" Click="SettingsButton_Click" GotKeyboardFocus="Control_GotKeyboardFocus" Margin="0,0,0,10" TabIndex="7" Height="50"/>
                        <Button Style="{StaticResource SpaceButton}" Content="About" Click="AboutButton_Click" GotKeyboardFocus="Control_GotKeyboardFocus" Margin="0,0,0,10" TabIndex="8" Height="50"/>
                        <Button Style="{StaticResource SpaceButton}" Content="Log out" Click="LogoutButton_Click" GotKeyboardFocus="Control_GotKeyboardFocus" TabIndex="9" BorderBrush="#FB7185" Height="50"/>
                    </StackPanel>
                </Border>

                <Grid x:Name="AboutOverlay"
                      Visibility="Collapsed"
                      Background="#AA000000"
                      Panel.ZIndex="999"
                      MouseDown="AboutOverlay_MouseDown"
                      Focusable="True"
                      KeyboardNavigation.IsTabStop="False">

                    <Border Style="{StaticResource GlassCard}"
                            Width="720"
                            Height="520"
                            Background="#CC10152A"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            MouseDown="AboutDialog_MouseDown">

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0">
                                <TextBlock Text="ABOUT"
                                           FontSize="22"
                                           FontWeight="Bold"
                                           HorizontalAlignment="Center"/>
                                <TextBlock Text="TETRIS - Outer Space Edition"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           Margin="0,8,0,0"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>

                            <Border Grid.Row="1"
                                    Margin="0,16,0,16"
                                    CornerRadius="14"
                                    BorderBrush="#2A2A33"
                                    BorderThickness="1"
                                    Background="#4410152A"
                                    Padding="12"
                                    MaxHeight="260">

                                <ScrollViewer x:Name="AboutScroll"
                                              VerticalScrollBarVisibility="Auto"
                                              HorizontalScrollBarVisibility="Disabled"
                                              CanContentScroll="False"
                                              Padding="0,0,6,0">

                                    <ScrollViewer.Resources>
                                        <Style TargetType="ScrollBar" BasedOn="{StaticResource SpaceScrollBar}"/>
                                    </ScrollViewer.Resources>

                                    <StackPanel>

                                        <TextBlock Text="Game Overview"
                                                   FontSize="16"
                                                   FontWeight="Bold"
                                                   Margin="0,0,0,10"/>

                                        <TextBlock TextWrapping="Wrap"
                                                   Foreground="#EAF0FF"
                                                   LineHeight="22">
                                            A classic Tetris experience reimagined with an outer-space atmosphere. In this game, you control falling tetromino blocks and place them on a 10×20 board.
                                            Your goal is to complete horizontal lines to score points, increase your level, and survive as the game speed gradually rises.
                                            The project focuses on a clean, modern interface with a “glass” look, neon accents, and cosmic background effects.
                                            The gameplay is designed to feel responsive and satisfying, with clear visual feedback for score, level progression, next pieces, and hold mechanics.
                                            This version is built as a WPF desktop application. The front-end provides multiple screens such as Login, Menu, Settings, and Gameplay.
                                            The system is structured so that the game logic can be implemented independently, allowing the UI to remain consistent and easy to extend.
                                            Future improvements may include sound packs, theme switching, and a richer profile system (avatar, username, and save data).
                                        </TextBlock>

                                        <TextBlock Text="Features"
                                                   FontSize="16"
                                                   FontWeight="Bold"
                                                   Margin="0,14,0,8"/>

                                        <StackPanel>
                                            <TextBlock Foreground="{StaticResource TextMuted}" TextWrapping="Wrap" LineHeight="20"
                                                       Text="• Classic Tetris gameplay on a 10×20 board"/>
                                            <TextBlock Foreground="{StaticResource TextMuted}" TextWrapping="Wrap" LineHeight="20" Margin="0,4,0,0"
                                                       Text="• New Game / Continue / Save Game flow"/>
                                            <TextBlock Foreground="{StaticResource TextMuted}" TextWrapping="Wrap" LineHeight="20" Margin="0,4,0,0"
                                                       Text="• Score, level, lines, hold and next preview panel"/>
                                            <TextBlock Foreground="{StaticResource TextMuted}" TextWrapping="Wrap" LineHeight="20" Margin="0,4,0,0"
                                                       Text="• Settings panel for music and volume (UI-ready)"/>
                                            <TextBlock Foreground="{StaticResource TextMuted}" TextWrapping="Wrap" LineHeight="20" Margin="0,4,0,0"
                                                       Text="• Account drawer with avatar and rename entry points (UI-ready)"/>
                                        </StackPanel>

                                        <Border Height="10" Opacity="0"/>
                                    </StackPanel>
                                </ScrollViewer>
                            </Border>

                            <StackPanel Grid.Row="2">
                                <Border Height="1" Background="#2A2A33" Margin="0,0,0,12"/>

                                <TextBlock Text="Team"
                                           FontSize="16"
                                           FontWeight="Bold"/>

                                <Grid Margin="0,8,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel>
                                        <TextBlock Text="• Nguyen Cao Xuan Trung" Foreground="{StaticResource TextMuted}"/>
                                        <TextBlock Text="• Tran Nhat Duy" Foreground="{StaticResource TextMuted}" Margin="0,6,0,0"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="• To Cong Huu Nhan" Foreground="{StaticResource TextMuted}"/>
                                        <TextBlock Text="• Nguyen Hoang Quoc Huy" Foreground="{StaticResource TextMuted}" Margin="0,6,0,0"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>

                            <Grid Grid.Row="3" Margin="0,14,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Version: 1.0"
                                           Foreground="{StaticResource TextMuted}"
                                           VerticalAlignment="Center"/>

                                <Button x:Name="CloseAboutButton"
                                        Grid.Column="1"
                                        Style="{StaticResource SpaceButton}"
                                        Width="140"
                                        Content="Close"
                                        Click="CloseAbout_Click"
                                        GotKeyboardFocus="Control_GotKeyboardFocus"/>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Page>